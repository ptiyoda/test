
for field, options in config.items():
    source = options.get("source", "host")
    if source != "host":
        # Vérifie si la relation existe réellement sur le modèle
        if hasattr(Host, source):
            prefetch_related_fields.append(source)
        else:
            # essaie le fallback par convention Django pour reverse FK
            related_name = f"{source}_set"
            if hasattr(Host, related_name):
                prefetch_related_fields.append(related_name)
            else:
                raise ValueError(f"Relation {source} ou {related_name} non trouvée sur Host")

hosts = Host.objects.select_related(*select_related_fields).prefetch_related(*prefetch_related_fields)

Résumé
